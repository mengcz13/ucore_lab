# LAB3实验报告

计45 孟垂正 2013010952

## 练习1

### 设计实现过程

- 获取线性地址对应的页表项;
- 若不存在对应的物理页, 则分配一个;

### 问题

- 请描述页目录项(Page Director Entry)和页表(Page Table Entry)中组成部分对ucore实现页替换算法的潜在用处.

PDE和PTE都是由物理地址+控制位组成, 只不过PDE存储了二级页表的起始物理地址, PTE存储了页的起始物理地址.

- 物理地址: 通过修改PTE中的页物理地址可以修改逻辑页和物理帧之间的映射关系;
- 控制位: 可以对页的访问权限进行控制. 改进的clock等页替换算法需要利用一些标记位进行实现, 以维护访问记录, 利用程序的局部性, 减少外存的IO次数.

- 如果ucore的缺页服务例程在执行过程中访问内存, 出现了页访问异常, 请问硬件要做哪些事情?

进入异常处理流程之前, 硬件要保存异常原因和发生访问异常的逻辑地址, 跳转到相应的异常处理向量入口.

异常处理结束之后硬件要返回到抛出页访问异常的程序处继续执行.

## 练习2

### 设计实现过程

- `vmm.c`
    - 继续修改`do_pgfault`函数. 若线性地址存在对应的物理页, 则在页缺失的前提下该页面必然在外存上, 此时通过FIFO策略换出1页, 然后从外存换入1页, 修改页表和Page结构, 并维护FIFO队列.
- `swap_fifo.c`
    - `_fifo_map_swappable`: 将最近换入的物理页插入FIFO队列尾部.
    - `_fifo_swap_out_victim`: 从队列中选择要换出的页, 对于FIFO选择队首的页即可.

### 问题

在ucore上实现extended clock页替换算法的设计方案.

需要在Page结构中添加修改位和使用位, 同时维护一个全局的时钟指针.

- 需要被换出的页的特征: 最近没有被访问过, 若所有页最近都访问过则选择最近没有修改过的页;
- 如何判断: 指针访问到的第一个使用位和修改位均为0的页;
- 何时进行换入换出: 发生缺页异常时进行换入换出.

## 与参考答案的区别

没有非常大的区别, 只是在实现FIFO时我的队列方向和答案的实现正好相反, 但不影响结果.

## 本实验中重要的知识点

- 页表项的查找与修改, 对应页式存储管理的相关知识;
- 页面替换算法, 对应课程中页面替换算法的相关知识;


## 实验没有对应的知识点

- Belady现象
- 全局页面置换算法